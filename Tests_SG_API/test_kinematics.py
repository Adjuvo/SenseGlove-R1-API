import pytest
import numpy as np
from numpy import array
import pytest

from SG_API import SG_RB_buffer, SG_timer
import SG_API.SG_exo_dimensions as exo_dim
import SG_API.SG_main as SG_main
import SG_API.SG_types as SG_T
import SG_API.SG_devices as SGR_device #TODO: this one should not be imported. Instead should be replaced by communication especially for simulation/tests, but todo due to time constraints.
import SG_API.transcode.rembrandt_v02 as v02_transcode # TODO: this one also should not be imported, but replaced by function to give data to communication for simulation/tests

from SG_API.SG_logger import sg_logger
import SG_API.SG_math as SG_math
import SG_API.SG_simulator as SG_sim
import SG_API.SG_callback_manager as SG_cb
import SG_API.SG_devices as SG_devices
import SG_API.SG_timer as SG_timer

import time
   


# Test case dictionaries containing all data from easy copy-paste from terminal output generated by generate_unit_test_output.py

# Test case dictionaries containing all data from easy copy-paste from terminal output generated by generate_unit_test_output.py
test_cases = [
        {
        'name': 'links_all_straight',
        'exo_angles': [
              [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.5707963267948966],
              [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.5707963267948966],
              [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.5707963267948966],
              [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.5707963267948966],
              [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.5707963267948966],
        ],
        'exo_poss': [
              [[-20.6385, 81.9688, -43.5289], [-12.08942479116903, 92.15719109348241, -43.5289], [10.408141547859845, 118.96874660264665, -43.5289], [32.90570788688872, 145.78030211181087, -43.5289], [55.4032742259176, 172.5918576209751, -43.5289], [77.90084056494648, 199.40341313013934, -43.5289], [100.39840690397536, 226.21496863930358, -43.5289], [122.89597324300424, 253.02652414846781, -43.5289], [130.52726737038194, 246.62310806077986, -44.40045742747658]],        
              [[62.2365, 72.0, 1.4391], [75.5365, 72.0, 1.4391], [110.5365, 72.0, 1.4391], [145.5365, 72.0, 1.4391], [180.5365, 72.0, 1.4391], [215.5365, 72.0, 1.4391], [250.5365, 72.0, 1.4391], [285.5365, 72.0, 1.4391], [285.5365, 72.0, -8.5609]],
              [[71.2365, 49.65, 1.4391], [84.5365, 49.65, 1.4391], [119.5365, 49.65, 1.4391], [154.5365, 49.65, 1.4391], [189.5365, 49.65, 1.4391], [224.5365, 49.65, 1.4391], [259.5365, 49.65, 1.4391], [294.5365, 49.65, 1.4391], [294.5365, 49.65, -8.5609]],
              [[62.2365, 27.3, 1.4391], [75.5365, 27.3, 1.4391], [110.5365, 27.3, 1.4391], [145.5365, 27.3, 1.4391], [180.5365, 27.3, 1.4391], [215.5365, 27.3, 1.4391], [250.5365, 27.3, 1.4391], [285.5365, 27.3, 1.4391], [285.5365, 27.3, -8.5609]],
              [[53.2365, 4.95, 0.4391], [66.5365, 4.95, 0.4391], [101.5365, 4.95, 0.4391], [136.5365, 4.95, 0.4391], [171.5365, 4.95, 0.4391], [206.5365, 4.95, 0.4391], [241.5365, 4.95, 0.4391], [276.5365, 4.95, 0.4391], [276.5365, 4.95, -9.5609]],
        ],
        'exo_rots': [
              [[0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6743797232066278, -0.6532814824381883, 0.2705980500730984, -0.21263110997159376]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0]],
        ],
        'fingertips_poss': [
              [139.5262939059935, 257.34773026444554, -44.40045742747658],
              [299.5365, 72.0, -8.560899999999997],
              [308.5365, 49.65, -8.560899999999997],
              [299.5365, 27.3, -8.560899999999997],
              [290.5365, 4.95, -9.560899999999997],
        ],
        'fingertips_rots': [
              [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.311586866503507],
              [1.0, 0.0, -1.1102230246251565e-16, 0.0],
              [1.0, 0.0, -1.1102230246251565e-16, 0.0],
              [1.0, 0.0, -1.1102230246251565e-16, 0.0],
              [1.0, 0.0, -1.1102230246251565e-16, 0.0],
        ],
        'flex_perc_bent_angles': [0.0, 0.0, 0.0, 0.0, 0.0],
        'abd_perc_bent_angles': [0.0, 0.0, 0.0, 0.0, 0.0],
        'flex_perc_bents': [0.0, 0.0, 0.0, 0.0, 0.0],
        'abd_perc_bents': [0.0, 5000.0, 5000.0, 5000.0, 5000.0]
    },
      {
        'name': 'fingertip_down_angle_3_90_rest_straight',
        'exo_angles': [
              [0.0, 0.0, 1.5707963267948966, 0.0, 0.0, 0.0, 0.0, 1.5707963267948966],
              [0.0, 0.0, 1.5707963267948966, 0.0, 0.0, 0.0, 0.0, 1.5707963267948966],
              [0.0, 0.0, 1.5707963267948966, 0.0, 0.0, 0.0, 0.0, 1.5707963267948966],
              [0.0, 0.0, 1.5707963267948966, 0.0, 0.0, 0.0, 0.0, 1.5707963267948966],
              [0.0, 0.0, 1.5707963267948966, 0.0, 0.0, 0.0, 0.0, 1.5707963267948966],
        ],
        'exo_poss': [
              [[-20.6385, 81.9688, -43.5289], [-12.08942479116903, 92.15719109348241, -43.5289], [10.408141547859845, 118.96874660264665, -43.5289], [37.117670993681784, 96.55679029573876, -46.57935099616804], [63.82720043950373, 74.14483398883088, -49.62980199233608], [90.53672988532567, 51.732877681923, -52.680252988504115], [117.24625933114761, 29.320921375015118, -55.730703984672154], [143.95578877696954, 6.908965068107236, -58.78115498084019], [137.52791268010415, -0.7514793630825469, -58.78115498084019]],
              [[62.2365, 72.0, 1.4391], [75.5365, 72.0, 1.4391], [110.5365, 72.0, 1.4391], [110.53650000000002, 72.0, -33.5609], [110.53650000000002, 72.0, -68.5609], [110.53650000000002, 72.0, -103.5609], [110.53650000000002, 72.0, -138.5609], [110.53650000000002, 72.0, -173.5609], [100.53650000000002, 72.0, -173.5609]],
              [[71.2365, 49.65, 1.4391], [84.5365, 49.65, 1.4391], [119.5365, 49.65, 1.4391], [119.53650000000002, 49.65, -33.5609], [119.53650000000002, 49.65, -68.5609], [119.53650000000002, 49.65, -103.5609], [119.53650000000002, 49.65, -138.5609], [119.53650000000002, 49.65, -173.5609], [109.53650000000002, 49.65, -173.5609]],
              [[62.2365, 27.3, 1.4391], [75.5365, 27.3, 1.4391], [110.5365, 27.3, 1.4391], [110.53650000000002, 27.3, -33.5609], [110.53650000000002, 27.3, -68.5609], [110.53650000000002, 27.3, -103.5609], [110.53650000000002, 27.3, -138.5609], [110.53650000000002, 27.3, -173.5609], [100.53650000000002, 27.3, -173.5609]],
              [[53.2365, 4.95, 0.4391], [66.5365, 4.95, 0.4391], [101.5365, 4.95, 0.4391], [101.53650000000002, 4.95, -34.5609], [101.53650000000002, 4.95, -69.5609], [101.53650000000002, 4.95, -104.5609], [101.53650000000002, 4.95, -139.5609], [101.53650000000002, 4.95, -174.5609], [91.53650000000002, 4.95, -174.5609]],
        ],
        'exo_rots': [
              [[0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6743797232066278, -0.6532814824381883, 0.2705980500730984, -0.21263110997159376], [0.6743797232066278, -0.6532814824381883, 0.2705980500730984, -0.21263110997159376], [0.6743797232066278, -0.6532814824381883, 0.2705980500730984, -0.21263110997159376], [0.6743797232066278, -0.6532814824381883, 0.2705980500730984, -0.21263110997159376], [0.6743797232066278, -0.6532814824381883, 0.2705980500730984, -0.21263110997159376], [0.28551675919156866, -0.311586866503507, 0.6682001915566582, -0.6122926660077799]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [2.220446049250313e-16, 0.0, 1.0, 0.0]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [2.220446049250313e-16, 0.0, 1.0, 0.0]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [2.220446049250313e-16, 0.0, 1.0, 0.0]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0], [2.220446049250313e-16, 0.0, 1.0, 0.0]],
        ],
        'fingertips_poss': [
              [148.21172445843294, -9.716261885845698, -60.001335379307406],
              [100.53650000000002, 72.0, -187.5609],
              [109.53650000000002, 49.65, -187.5609],
              [100.53650000000002, 27.3, -187.5609],
              [91.53650000000002, 4.95, -188.5609],

        ],
        'fingertips_rots': [
              [0.6743797232066279, -0.6532814824381884, 0.27059805007309834, -0.21263110997159376],
              [0.7071067811865477, 0.0, 0.7071067811865475, 0.0],
              [0.7071067811865477, 0.0, 0.7071067811865475, 0.0],
              [0.7071067811865477, 0.0, 0.7071067811865475, 0.0],
              [0.7071067811865477, 0.0, 0.7071067811865475, 0.0],
        ],
        'flex_perc_bent_angles': [1.5707963267948963, 1.5707963267948963, 1.5707963267948963, 1.5707963267948963, 1.5707963267948963],
        'abd_perc_bent_angles': [0.0, 0.0, 0.0, 0.0, 0.0],
        'flex_perc_bents': [8726.646259971647, 3819.0307435056416, 4616.935317494901, 4473.303661233165, 4982.112028914451],
        'abd_perc_bents': [0.0, 5000.0, 5000.0, 5000.0, 5000.0]
    },
    {
        'name': 'pinch_angles_recording',
        'exo_angles': [
              [-0.5342414168895302, -0.5338138032328201, -3.8145642363223797, 3.9395913015815234, -4.066919478471203, 4.413620297472018, -4.466929383579443, 0.8893802204802186],
              [-0.25388931656918046, -0.5756173311875644, -3.9503298225240258, 4.744980372269256, -4.592339967443676, 5.481336094040898, -4.308152681072434, 1.018242471790256],
              [-0.20134726767193314, -0.8947048106219424, -3.778129968838887, 4.184659690233648, -4.166250797189357, 4.371049732307094, -4.2928119368688575, 0.7858301971060815],
              [-0.11390502571155071, -1.2690189691891933, -3.6500347547390284, 4.01821261562485, -4.156662832062121, 4.176222280921681, -4.135185790177116, 0.6642547992927427],
              [-0.04525519540054845, -1.1731393179168441, -3.6066971523639264, 3.608614745389374, -3.877461287557041, 3.818782940978363, -3.7558858897437024, 0.4955066130534082],
        ],
        'exo_poss': [
              [[-20.6385, 81.9688, -43.5289], [-12.828547091486639, 90.35809443089585, -36.78246579232082], [-8.725801367694627, 120.76731797577028, -19.94659334911907], [8.916411186169485, 91.96387393018716, -29.117958968111793], [17.158529743977645, 121.13056571078886, -11.614485819778729], [38.30429320885948, 94.16681126993491, -18.742783929467894], [57.15998157564671, 117.59193882658985, -0.8339476979019373], [79.67399899668035, 91.530031847079, -7.070615410448231], [78.16072597870112, 82.92960509312579, -11.943259910403235]],
              [[62.2365, 72.0, 1.4391], [75.11014008539625, 68.6594325404688, 1.4391], [103.52891794727418, 61.28507346756538, 20.49144613114942], [97.24917103221233, 62.914598455011955, -13.90200421914341], [130.3177571804551, 54.33366547205263, -21.50701567858296], [119.04919843225441, 57.25773204687921, -54.51412731235564], [134.1732106038913, 53.333217878160404, -85.8328508554968], [100.35322413142202, 62.109130948767174, -87.88025525598702], [94.79959327607865, 63.55023683603321, -79.68999285822069]],
              [[71.2365, 49.65, 1.4391], [84.267813768162, 46.99013882397751, 1.4391], [105.72658440918428, 42.61012373657494, 28.73995402345732], [104.37050859656401, 42.886916504357444, -6.2326701868322125], [134.6576905008098, 36.70490748274544, 10.18285224639645], [132.67107896663953, 37.1104008186889, -24.75836910842753], [165.5963030346701, 30.389932969594366, -14.97241325530481], [160.94000281213567, 31.340344601619016, -49.64827785833003], [153.13267376645697, 32.93392233188362, -55.69030758269472]],
              [[62.2365, 27.3, 1.4391], [75.45031378472568, 25.78833692160137, 1.4391], [85.78552304949643, 24.60598680621402, 34.85744073765544], [92.92086991588903, 23.789701622752357, 0.6022148064851294], [114.5133156344815, 21.319521287469207, 28.03694638893039], [126.27725625580098, 19.973724004153574, -4.899333466728642], [148.39866869888155, 17.443029764244763, 22.105086508290505], [158.81025154524082, 16.25194249504752, -11.28922818374285], [155.30869765058935, 16.65252099765107, -20.647575109674968]],
              [[53.2365, 4.95, 0.4391], [66.5228829067326, 4.348311329935803, 0.4391], [80.06307900125651, 3.73512844654967, 32.708080406473364], [82.41953660284453, 3.628413635580035, -2.2123394008691264], [96.02152318244285, 3.0124325011538686, 30.03059049593861], [107.55938283693052, 2.4899276569363935, -3.008852345627517], [119.24901897909145, 1.960549445177414, 29.977086561318878], [128.68947663356556, 1.5330277900518825, -3.7229873927317314], [126.48885282653525, 1.6326854938120774, -13.477336330616447]],
        ],
        'exo_rots': [
              [[0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.7267474262701483, -0.5152139658525046, -0.4370088077106744, 0.12416138604068694], [0.5857535612403102, -0.4642234577133333, -0.6132138983269084, 0.25565222803974796], [-0.7722247709425946, 0.39458904071831735, -0.35043890016613066, 0.353780962373625], [0.6229185924958973, -0.4792879906160399, -0.5754224072191838, 0.22615150329867148], [-0.7929556462025136, 0.4162975839086166, -0.30059917292391886, 0.32796006163076996], [0.7128334157762015, -0.5111120210102891, -0.45935502714112414, 0.1400927634526062], [-0.8006853642790315, 0.42489030081873513, -0.2793590289150228, 0.3167486585025655], [-0.6026397715387523, 0.24730882487440436, -0.5966270404253485, 0.46872147970010003]],
              [[1.0, 0.0, 0.0, 0.0], [0.9919533415346783, 0.0, 0.0, -0.12660398184174912], [0.9511525063954271, -0.03593675641550348, -0.28156764970342557, -0.12139653107283878], [-0.6330793705358088, -0.09746712464628693, -0.763663500753963, 0.08080054350913185], [0.9860105963216823, 0.013837539076209299, 0.10841833665563366, -0.1258455034178827], [-0.5730101048211538, -0.10334412941366984, -0.8097103504060352, 0.0731338439706037], [0.8435762061272261, 0.06660706564370963, 0.5218722221366161, -0.10766646192998311], [-0.029025709317193116, -0.1265497700757107, -0.9915285875759949, 0.0037045798642630356], [0.4579365993611174, -0.11230551276943852, -0.8799235777880878, -0.058446899145972016]],
              [[1.0, 0.0, 0.0, 0.0], [0.9949366883579459, 0.0, 0.0, -0.10050366241746433], [0.8970304982064883, -0.043475873628230084, -0.43038970611307115, -0.09061365554697481], [-0.6894760903614328, -0.0724583274099823, -0.717301704069208, 0.06964751932604232], [0.9654450167227582, -0.02428882229966215, -0.2404473612370689, -0.0975245572695363], [-0.682844611779259, -0.07309631584540954, -0.7236174749166229, 0.06897763963163542], [0.9849664536056731, -0.014192572017479574, -0.14049946303149885, -0.09949651782274738], [-0.6540223050252267, -0.07573803484283687, -0.7497691900646261, 0.06606615046655026], [-0.317109867327575, -0.09526216331551998, -0.9430484324170014, 0.03203289558829844]],
              [[1.0, 0.0, 0.0, 0.0], [0.998378643961804, 0.0, 0.0, -0.05692172942725389], [0.8040567828650914, -0.03374220751850022, -0.5918214313858953, -0.045842629863130334], [-0.7750134917032357, -0.03588334349959768, -0.6293758848231867, 0.04418675073231095], [0.898804447539421, -0.0247805437584199, -0.43463833448324257, -0.05124458929512986], [-0.8166910804654548, -0.03274100912382491, -0.5742609126583307, 0.04656296385050156], [0.9030120410814562, -0.024278208751816178, -0.42582762989373235, -0.05148448174734536], [-0.8047371741077842, -0.03368944069215597, -0.5908959276624173, 0.04588142180490058], [-0.5680944440485545, -0.04680820343263003, -0.8209924599898435, 0.03238943303608483]],
              [[1.0, 0.0, 0.0, 0.0], [0.9997440068339865, 0.0, 0.0, -0.02262566683052862], [0.8326310920260167, -0.0125234727801766, -0.5533656510771487, -0.018843657528469858], [-0.7303594802718739, -0.015450229761531062, -0.6826881489944527, 0.01652910160420048], [0.8331612742862377, -0.012505399793463596, -0.5525670730601006, -0.018855656327259565], [-0.8152638043719456, -0.013095639490422745, -0.5786475684572225, 0.018450610446892085], [0.8165931773898618, -0.0130531479421604, -0.576770025088686, -0.018480696099610446], [-0.7966660722408796, -0.013669313021916863, -0.6039960666600103, 0.018029716609945293], [-0.6242246905277712, -0.017673295787515485, -0.7809171626593836, 0.014127116320504713]],
        ],
        'fingertips_poss': [
              [91.47388994556746, 79.27241937925368, -9.622773356772372],
              [83.70080482199462, 66.43024989403322, -87.72257772470297],
              [161.42063009643147, 31.242242301545573, -66.84593390071879],
              [168.32548224133956, 15.16339810051666, -25.581724673200387],
              [140.13095966807387, 1.014887468572291, -16.561367219575754],
        ],
        'fingertips_rots': [
              [-0.8480096951917879, 0.5063098838997011, 0.004251642943739142, 0.1565623896677658],
              [-0.2983898540181322, -0.12074018836934544, -0.9460100035416388, 0.03808379091845934],
              [-0.8910664791178999, -0.04470984397937808, -0.4426054039809106, 0.09001119936243102],
              [-0.9822327695029782, -0.010195610323768957, -0.17882590202070903, 0.0560011858009753],
              [-0.9935853329176694, -0.0025075275484278143, -0.11079830960514725, 0.022486287046107875],
        ],
        'flex_perc_bent_angles': [1.0727538983126035, 2.5305081162573995, 0.9220310865124688, 0.36017633005650396, 0.22210963222432056],
        'abd_perc_bent_angles': [-0.5342414168895302, -0.25388931656918046, -0.20134726767193314, -0.11390502571155071, -0.04525519540054845],
        'flex_perc_bents': [5959.7438795144635, 7320.350661282012, 2173.3750904424437, 0.0, 0.0],
        'abd_perc_bents': [0.0, 768.511390513659, 1644.212205467781, 3101.5829048074884, 4245.746743324193]
    },
    {
        'name': 'in_calibration_jig',
        'exo_angles': [
              [0.0, -1.1278317626387357, 2.255838058202671, -2.255838058202671, 2.255838058202671, -2.255838058202671, 2.255838058202671, 0.4429645641561608],
              [0.0, -1.3548990983231979, 2.709623663721197, -2.709623663721197, 2.709623663721197, -2.709623663721197, 2.709623663721197, 0.21589722847169854],
              [0.0, -1.1278317626387357, 2.255838058202671, -2.255838058202671, 2.255838058202671, -2.255838058202671, 2.255838058202671, 0.4429645641561608],
              [0.0, -0.8724900930719653, 1.7451547190691301, -1.7451547190691301, 1.7451547190691301, -1.7451547190691301, 1.7451547190691301, 0.6983062337229312],
              [0.0, -0.5410520681182421, 1.0821041362364843, -1.0821041362364843, 1.0821041362364843, -1.0821041362364843, 1.0821041362364843, 1.0297442586766545],
        ],
        'exo_poss': [
              [[-20.6385, 81.9688, -43.5289], [-12.08942479116903, 92.15719109348241, -43.5289], [-26.5781810328494, 123.89801976531663, -40.7728633902224], [7.194829233973138, 115.13521302017506, -43.52912815696745], [-7.293927007707236, 146.8760416920093, -40.77309154718985], [26.47908325911531, 138.11323494686772, -43.529356313934905], [11.990327017434932, 169.85406361870196, -40.773319704157295], [45.763337284257474, 161.09125687356038, -43.52958447090235], [53.393509419391606, 154.68650388363392, -44.40114188510436]],
              [[62.2365, 72.0, 1.4391], [75.5365, 72.0, 1.4391], [83.03433696710577, 72.0, 35.62656028611517], [90.53814065743154, 72.0, 1.4404091401166923], [98.03597762453731, 72.0, 35.62786942623187], [105.53978131486308, 72.0, 1.4417182802333812], [113.03761828196883, 72.0, 35.629178566348564], [120.54142197229461, 72.0, 1.4430274203500701], [120.54316730153775, 72.0, -8.556972427341224]],
              [[71.2365, 49.65, 1.4391], [84.5365, 49.65, 1.4391], [99.5381924321295, 49.65, 33.061073755156215], [114.5343655602181, 49.65, 1.4364821923803746], [129.5360579923476, 49.65, 33.05845594753659], [144.5322311204362, 49.65, 1.4338643847607457], [159.53392355256568, 49.65, 33.05583813991696], [174.53009668065428, 49.65, 1.431246577141117], [174.52835135141115, 49.65, -8.568753270550172]],
              [[62.2365, 27.3, 1.4391], [75.5365, 27.3, 1.4391], [98.03874549555975, 27.3, 28.246728534757803], [120.53631183458863, 27.3, 1.4351730255935777], [143.03855733014836, 27.3, 28.242801560351374], [165.53612366917724, 27.3, 1.431246051187152], [188.038369164737, 27.3, 28.23887458594495], [210.53593550376587, 27.3, 1.4273190767807264], [210.53419017452273, 27.3, -8.572680770910562]],
              [[53.2365, 4.95, 0.4391], [66.5365, 4.95, 0.4391], [96.53735552457394, 4.95, 18.465432621851892], [126.53821104914788, 4.95, 0.4390999999999998], [156.5390665737218, 4.95, 18.465432621851892], [186.53992209829573, 4.95, 0.4390999999999998], [216.54077762286965, 4.95, 18.465432621851892], [246.54163314744358, 4.95, 0.4390999999999998], [246.54163314744358, 4.95, -9.5609]],
        ],
        'exo_rots': [
              [[0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.4121331226419668, -0.35094737097943374, -0.5984627014250702, 0.5906137714505246], [0.7173403504736207, -0.6840280672769978, 0.11590572616568284, -0.06398661892680124], [0.4121331226419668, -0.35094737097943374, -0.5984627014250703, 0.5906137714505246], [0.7173403504736208, -0.6840280672769978, 0.11590572616568284, -0.06398661892680124], [0.4121331226419668, -0.35094737097943374, -0.5984627014250704, 0.5906137714505246], [0.7173403504736209, -0.6840280672769978, 0.11590572616568279, -0.06398661892680124], [0.6743561065041942, -0.6532629243858944, 0.270656899775556, -0.21268811872593643]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.7791738937316494, 0.0, -0.6268078200908636, 0.0], [0.7792285900658948, 0.0, 0.6267398219547866, 0.0], [0.7791738937316494, 0.0, -0.6268078200908637, 0.0], [0.779228590065895, 0.0, 0.6267398219547866, 0.0], [0.7791738937316494, 0.0, -0.6268078200908638, 0.0], [0.7792285900658951, 0.0, 0.6267398219547866, 0.0], [0.7071684852014808, 0.0, 0.7070450717866884, 0.0]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.8451685582696296, 0.0, -0.5344998672707373, 0.0], [0.8451219111388486, 0.0, 0.5345736201057998, 0.0], [0.8451685582696296, 0.0, -0.5344998672707373, 0.0], [0.8451219111388486, 0.0, 0.5345736201057998, 0.0], [0.8451685582696296, 0.0, -0.5344998672707373, 0.0], [0.8451219111388486, 0.0, 0.5345736201057998, 0.0], [0.7070450717866883, 0.0, 0.7071684852014806, 0.0]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.906344663986371, 0.0, -0.4225391698569875, 0.0], [0.9063077870366499, 0.0, 0.42261826174069933, 0.0], [0.9063446639863709, 0.0, -0.4225391698569874, 0.0], [0.9063077870366498, 0.0, 0.42261826174069933, 0.0], [0.9063446639863709, 0.0, -0.4225391698569874, 0.0], [0.9063077870366498, 0.0, 0.42261826174069933, 0.0], [0.7070450717866883, 0.0, 0.7071684852014805, 0.0]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.963630453208623, 0.0, -0.26723837607825685, 0.0], [0.963630453208623, 0.0, 0.26723837607825685, 0.0], [0.963630453208623, 0.0, -0.26723837607825685, 0.0], [0.963630453208623, 0.0, 0.26723837607825685, 0.0], [0.963630453208623, 0.0, -0.26723837607825685, 0.0], [0.963630453208623, 0.0, 0.26723837607825685, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0]],
        ],
        'fingertips_poss': [
              [62.39440049485263, 165.40956127424477, -44.401354846757485],
              [134.54316708830555, 72.0, -8.554528966400833],
              [188.52835113817895, 49.65, -8.57119673149056],
              [224.53418996129054, 27.3, -8.575124231850946],
              [260.5416331474436, 4.95, -9.560899999999997],
        ],
        'fingertips_rots': [
              [0.6682251050498969, -0.61231985475994, -0.28545844663745, 0.31153343270210165],
              [0.9999999961922825, 0.0, -8.726646248913283e-05, 0.0],
              [0.9999999961922823, 0.0, 8.72664624889663e-05, 0.0],
              [0.9999999961922821, 0.0, 8.726646248885528e-05, 0.0],
              [1.0, 0.0, -1.1102230246251565e-16, 0.0],
        ],
        'flex_perc_bent_angles': [0.00017453292519917913, -0.0001745329251994221, 0.00017453292519945665, 0.00017453292519923456, 0.0],
        'abd_perc_bent_angles': [0.0, 0.0, 0.0, 0.0, 0.0],
        'flex_perc_bents': [0.9696273622176619, 0.0, 0.0, 0.0, 0.0],
        'abd_perc_bents': [0.0, 5000.0, 5000.0, 5000.0, 5000.0]
    },
    {
        'name': 'unnormalized_angles',
        'exo_angles': [
              [0.17453292519943295, -1.1278317626387357, 8.539023365382258, -2.255838058202671, 2.255838058202671, -2.255838058202671, 2.255838058202671, 0.4429645641561608],
              [0.08726646259971647, 4.928286208856388, 2.709623663721197, -2.709623663721197, 2.709623663721197, -8.992808970900782, 2.709623663721197, 0.21589722847169854],
              [0.17453292519943295, -1.1278317626387357, 8.539023365382258, -2.255838058202671, 2.255838058202671, -2.255838058202671, 2.255838058202671, 0.4429645641561608],
              [-0.17453292519943295, -0.8724900930719653, 1.7451547190691301, -8.028340026248717, 1.7451547190691301, -1.7451547190691301, 1.7451547190691301, 0.6983062337229312],
              [0.0, -0.5410520681182421, 1.0821041362364843, -1.0821041362364843, 1.0821041362364843, -1.0821041362364843, 1.0821041362364843, 1.0297442586766545],
        ],
        'exo_poss': [
              [[-20.6385, 81.9688, -43.5289], [-12.373500005200876, 92.13179197034579, -45.82963233920369], [-27.182677975339672, 123.84397178253028, -45.66869940772591], [6.270028450052763, 115.0525267180008, -51.01911308274847], [-8.539149520086006, 146.7647065301853, -50.85818015127069], [24.91355690530643, 137.9732614656558, -56.208593826293246], [10.10437893516766, 169.6854412778403, -56.047660894815465], [43.557085360560095, 160.89399621331083, -61.39807456983802], [51.187294774248976, 154.48924655645445, -62.269330064082716]],
              [[62.2365, 72.0, 1.4391], [75.48588948462022, 73.15917137854386, 1.4391], [82.95519491840727, 73.81265092841281, 35.626560286115186], [90.43044437023109, 74.46665051247577, 1.4404091401166852], [97.89974980401814, 75.12013006234471, 35.62786942623188], [105.37499925584196, 75.77412964640767, 1.4417182802333741], [112.84430468962906, 76.42760919627663, 35.629178566348564], [120.31955414145284, 77.0816087803396, 1.4430274203500417], [120.32129282919126, 77.08176089580611, -8.556972427341258]],
              [[71.2365, 49.65, 1.4391], [84.33444311506237, 51.95952076297017, 1.4391], [99.10822613052807, 54.56453731572924, 33.06107375515622], [113.87657369258304, 57.16859545139961, 1.4364821923803675], [128.65035670804878, 59.77361200415868, 33.05845594753657], [143.41870427010375, 62.37767013982905, 1.4338643847607102], [158.19248728556948, 64.98268669258812, 33.05583813991691], [172.96083484762445, 67.58674482825849, 1.4312465771410459], [172.95911603385426, 67.58644175501598, -8.568753270550244]],
              [[62.2365, 27.3, 1.4391], [75.33444311506237, 24.990479237029827, 1.4391], [97.49482893927365, 21.083005313311986, 28.246728534757803], [119.65060669385576, 17.17634391659875, 1.4351730255935777], [141.81099251806702, 13.268869992880909, 28.242801560351385], [163.96677027264914, 9.362208596167669, 1.4312460511871627], [186.1271560968604, 5.454734672449828, 28.238874585944973], [208.28293385144252, 1.548073275736587, 1.4273190767807549], [208.28121503767233, 1.5483763489790845, -8.572680770910534]],
              [[53.2365, 4.95, 0.4391], [66.5365, 4.95, 0.4391], [96.53735552457394, 4.95, 18.465432621851892], [126.53821104914788, 4.95, 0.4390999999999998], [156.5390665737218, 4.95, 18.465432621851892], [186.53992209829573, 4.95, 0.4390999999999998], [216.54077762286965, 4.95, 18.465432621851892], [246.54163314744358, 4.95, 0.4390999999999998], [246.54163314744358, 4.95, -9.5609]],
        ],
        'exo_rots': [
              [[0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6385009033121033, -0.6348471327716556, -0.23106545963812644, 0.3686386684050621], [0.416136430398716, -0.3395155165928613, -0.5365679094608297, 0.6508875201020003], [-0.6631326029111697, 0.7335877296092755, -0.14604725647682465, 0.027827914017365174], [-0.4161364303987162, 0.3395155165928615, 0.5365679094608294, -0.6508875201020002], [-0.6631326029111697, 0.7335877296092755, -0.1460472564768247, 0.02782791401736523], [-0.41613643039871623, 0.33951551659286155, 0.5365679094608294, -0.6508875201020002], [-0.6631326029111697, 0.7335877296092755, -0.14604725647682476, 0.027827914017365285], [-0.614851128092849, 0.709555185286807, -0.28815402209773416, 0.18829973145082896]],
              [[1.0, 0.0, 0.0, 0.0], [0.9990482215818578, 0.0, 0.0, 0.043619387365336], [-0.7784322928356157, -0.02734097310816522, 0.6262112379353785, -0.03398708789563796], [-0.778486937111071, 0.027338007071127556, -0.6261433045184598, -0.03398947371622888], [-0.7784322928356158, -0.027340973108165224, 0.6262112379353787, -0.033987087895637966], [-0.778486937111071, 0.027338007071127563, -0.6261433045184599, -0.03398947371622889], [0.7784322928356162, 0.027340973108165207, -0.6262112379353781, 0.03398708789563799], [0.7784869371110708, -0.02733800707112758, 0.6261433045184603, 0.033989473716228874], [0.7064954174992755, -0.030840872871015387, 0.7063721215467086, 0.03084625608856125]],
              [[1.0, 0.0, 0.0, 0.0], [0.9961946980917455, 0.0, 0.0, 0.08715574274765817], [0.8419524367420494, 0.046584732930505815, -0.5324659339058502, 0.07366129344295698], [-0.8419059671176841, 0.04659116091362546, -0.532539406089109, -0.07365722787762671], [-0.8419524367420497, -0.0465847329305058, 0.5324659339058498, -0.073661293442957], [-0.8419059671176841, 0.04659116091362546, -0.5325394060891091, -0.07365722787762671], [-0.8419524367420497, -0.0465847329305058, 0.5324659339058497, -0.073661293442957], [-0.8419059671176841, 0.04659116091362546, -0.5325394060891091, -0.07365722787762671], [-0.7043545518257962, 0.06163379457547137, -0.7044774956152863, -0.061623038387640106]],
              [[1.0, 0.0, 0.0, 0.0], [0.9961946980917455, 0.0, 0.0, -0.08715574274765817], [0.9028957489069674, -0.036826715188864635, -0.42093128074761843, -0.07899314237510884], [0.9028590122851734, 0.03683360850073486, 0.42101007166283433, -0.07898992833716562], [-0.9028957489069673, 0.036826715188864656, 0.42093128074761854, 0.07899314237510882], [-0.9028590122851736, -0.03683360850073483, -0.42101007166283416, 0.07898992833716563], [-0.9028957489069673, 0.036826715188864656, 0.4209312807476186, 0.07899314237510882], [-0.9028590122851736, -0.03683360850073483, -0.4210100716628341, 0.07898992833716563], [-0.7043545518257968, -0.06163379457547132, -0.7044774956152857, 0.06162303838764013]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.963630453208623, 0.0, -0.26723837607825685, 0.0], [0.963630453208623, 0.0, 0.26723837607825685, 0.0], [0.963630453208623, 0.0, -0.26723837607825685, 0.0], [0.963630453208623, 0.0, 0.26723837607825685, 0.0], [0.963630453208623, 0.0, -0.26723837607825685, 0.0], [0.963630453208623, 0.0, 0.26723837607825685, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0]],
        ],
        'fingertips_poss': [
              [59.88915931317829, 165.18556802838128, -64.69136650380062],
              [134.26801839005495, 78.30194127568892, -8.554528966400884],
              [186.74642436603244, 70.01751620532562, -8.571196731490645],
              [222.0685233698505, -0.8826981013305586, -8.575124231850912],
              [260.5416331474436, 4.95, -9.560899999999997],
        ],
        'fingertips_rots': [
              [-0.6385210651461383, 0.6348793001468654, 0.23100973904316605, -0.3685832661378915],
              [0.9990482177777646, 3.80650963128365e-06, -8.718340415286852e-05, 0.0436193871992457],
              [-0.9961946942985174, 7.605773355207068e-06, -8.693438725321245e-05, -0.08715574241579371],
              [-0.9961946942985174, -7.605773355151557e-06, -8.69343872524353e-05, 0.0871557424157937],
              [1.0, 0.0, -1.1102230246251565e-16, 0.0],
        ],
        'flex_perc_bent_angles': [0.00017453292520031027, -0.00017453292519853392, 0.00017453292520031027, 0.00017453292519853392, 0.0],
        'abd_perc_bent_angles': [0.17453292519943295, 0.08726646259971647, 0.17453292519943295, -0.17453292519943295, 0.0],
        'flex_perc_bents': [0.969627362223946, 0.0, 0.0, 0.0, 0.0],
        'abd_perc_bents': [3490.658503988659, 6454.441043328608, 7908.882086657216, 2091.117913342784, 5000.0]
    },
    {
        'name': 'finger_splay_90_deg',
        'exo_angles': [
              [0.0, -0.5410520681182421, 1.0821041362364843, -1.0821041362364843, 1.0821041362364843, -1.0821041362364843, 1.0821041362364843, 1.0297442586766545],
              [0.0, -0.5410520681182421, 1.0821041362364843, -1.0821041362364843, 1.0821041362364843, -1.0821041362364843, 1.0821041362364843, 1.0297442586766545],
              [-1.5707963267948966, -0.8724900930719653, 1.7451547190691301, -1.7451547190691301, 1.7451547190691301, -1.7451547190691301, 1.7451547190691301, 0.6983062337229312],
              [1.5707963267948966, -1.1278317626387357, 2.255838058202671, -2.255838058202671, 2.255838058202671, -2.255838058202671, 2.255838058202671, 0.4429645641561608],
              [0.0, -1.3548990983231979, 2.709623663721197, -2.709623663721197, 2.709623663721197, -2.709623663721197, 2.709623663721197, 0.21589722847169854],
        ],
        'exo_poss': [
              [[-20.6385, 81.9688, -43.5289], [-12.08942479116903, 92.15719109348241, -43.5289], [-6.5616712075064925, 126.68219058817564, -41.95780159132615], [26.47893163121512, 138.1211684203127, -43.5289], [32.00668521487766, 172.64616791500595, -41.95780159132616], [65.04728805359927, 184.08514574714303, -43.52890000000001], [70.57504163726182, 218.61014524183628, -41.95780159132617], [103.61564447598343, 230.04912307397336, -43.528900000000014], [111.24693860336113, 223.6457069862854, -44.400457427476596]],
              [[62.2365, 72.0, 1.4391], [75.5365, 72.0, 1.4391], [105.53735552457394, 72.0, 19.465432621851892], [135.53821104914786, 72.0, 1.4390999999999998], [165.53906657372178, 72.0, 19.465432621851892], [195.5399220982957, 72.0, 1.4390999999999998], [225.54077762286963, 72.0, 19.465432621851892], [255.54163314744355, 72.0, 1.4390999999999998], [255.54163314744355, 72.0, -8.5609]],
              [[71.2365, 49.65, 1.4391], [71.2365, 36.349999999999994, 1.4391], [71.2365, 13.84775450444025, 28.246728534757803], [71.2365, -8.649811834588629, 1.4351730255935813], [71.23650000000002, -31.15205733014837, 28.242801560351385], [71.23650000000002, -53.649623669177245, 1.4312460511871627], [71.23650000000004, -76.15186916473698, 28.238874585944966], [71.23650000000004, -98.64943550376586, 1.4273190767807442], [71.23650000000004, -98.64769017452272, -8.572680770910544]],
              [[62.2365, 27.3, 1.4391], [62.2365, 40.6, 1.4391], [62.2365, 55.6016924321295, 33.061073755156215], [62.2365, 70.5978655602181, 1.4364821923803568], [62.2365, 85.5995579923476, 33.05845594753659], [62.2365, 100.5957311204362, 1.4338643847607173], [62.2365, 115.5974235525657, 33.05583813991696], [62.2365, 130.59359668065431, 1.4312465771410814], [62.2365, 130.59185135141118, -8.568753270550218]],    
              [[53.2365, 4.95, 0.4391], [66.5365, 4.95, 0.4391], [74.03433696710577, 4.95, 34.62656028611517], [81.53814065743154, 4.95, 0.4404091401166923], [89.03597762453731, 4.95, 34.62786942623187], [96.53978131486308, 4.95, 0.4417182802333812], [104.03761828196883, 4.95, 34.629178566348564], [111.54142197229461, 4.95, 0.44302742035007014], [111.54316730153775, 4.95, -9.556972427341224]],
        ],
        'exo_rots': [
              [[0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.5675970183543498, -0.5067558910296831, -0.45370137814521005, 0.4638826911311746], [0.7201990884933128, -0.6732918274531027, -0.09656390997164699, 0.13662649563408347], [0.5675970183543498, -0.5067558910296832, -0.45370137814521, 0.46388269113117464], [0.7201990884933128, -0.6732918274531028, -0.09656390997164699, 0.13662649563408347], [0.5675970183543498, -0.5067558910296832, -0.45370137814521, 0.46388269113117464], [0.7201990884933128, -0.6732918274531028, -0.09656390997164699, 0.13662649563408347], [0.6743797232066278, -0.6532814824381884, 0.27059805007309845, -0.2126311099715938]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.963630453208623, 0.0, -0.26723837607825685, 0.0], [0.963630453208623, 0.0, 0.26723837607825685, 0.0], [0.963630453208623, 0.0, -0.26723837607825685, 0.0], [0.963630453208623, 0.0, 0.26723837607825685, 0.0], [0.963630453208623, 0.0, -0.26723837607825685, 0.0], [0.963630453208623, 0.0, 0.26723837607825685, 0.0], [0.7071067811865476, 0.0, 0.7071067811865475, 0.0]],
              [[1.0, 0.0, 0.0, 0.0], [0.7071067811865476, 0.0, 0.0, -0.7071067811865475], [0.6408824579970058, -0.29878031232281027, -0.2987803123228103, -0.6408824579970057], [0.6408563820557887, 0.29883623873011966, 0.2988362387301198, -0.6408563820557884], [0.6408824579970058, -0.29878031232281027, -0.2987803123228104, -0.6408824579970056], [0.6408563820557887, 0.29883623873011966, 0.2988362387301198, -0.6408563820557884], [0.6408824579970058, -0.29878031232281027, -0.2987803123228104, -0.6408824579970056], [0.6408563820557887, 0.29883623873011966, 0.2988362387301198, -0.6408563820557884], [0.4999563648648968, 0.5000436313273854, 0.5000436313273856, -0.49995636486489664]],
              [[1.0, 0.0, 0.0, 0.0], [0.7071067811865476, 0.0, 0.0, 0.7071067811865475], [0.5976244187981128, 0.3779484806904479, -0.37794848069044795, 0.5976244187981128], [0.5975914342956148, -0.37800063182025245, 0.37800063182025245, 0.5975914342956148], [0.5976244187981129, 0.377948480690448, -0.377948480690448, 0.5976244187981129], [0.5975914342956149, -0.3780006318202525, 0.3780006318202525, 0.5975914342956149], [0.597624418798113, 0.37794848069044806, -0.37794848069044806, 0.597624418798113], [0.597591434295615, -0.37800063182025256, 0.37800063182025256, 0.597591434295615], [0.4999563648648969, -0.5000436313273858, 0.5000436313273858, 0.4999563648648969]],
              [[1.0, 0.0, 0.0, 0.0], [1.0, 0.0, 0.0, 0.0], [0.7791738937316494, 0.0, -0.6268078200908636, 0.0], [0.7792285900658948, 0.0, 0.6267398219547866, 0.0], [0.7791738937316494, 0.0, -0.6268078200908637, 0.0], [0.779228590065895, 0.0, 0.6267398219547866, 0.0], [0.7791738937316494, 0.0, -0.6268078200908638, 0.0], [0.7792285900658951, 0.0, 0.6267398219547866, 0.0], [0.7071684852014808, 0.0, 0.7070450717866884, 0.0]],
        ],
        'fingertips_poss': [
              [120.24596513897268, 234.3703291899511, -44.400457427476596],
              [269.5416331474436, 72.0, -8.560899999999997],
              [71.23650000000005, -112.64768996129052, -8.575124231850927],
              [62.2365, 144.591851138179, -8.571196731490602],
              [125.54316708830557, 4.95, -9.554528966400833],
        ],
        'fingertips_rots': [
              [0.6682001915566583, -0.61229266600778, -0.2855167591915686, 0.311586866503507],
              [1.0, 0.0, -1.1102230246251565e-16, 0.0],
              [0.7071067784940847, 6.170670739596984e-05, 6.170670739602535e-05, -0.7071067784940843],
              [0.7071067784940849, -6.170670739602535e-05, 6.170670739602535e-05, 0.7071067784940849],
              [0.9999999961922825, 0.0, -8.726646248913283e-05, 0.0],
        ],
        'flex_perc_bent_angles': [0.0, 0.0, 0.0001745329251994221, 0.0001745329251994221, -0.00017453292519920005],
        'abd_perc_bent_angles': [0.0, 0.0, -1.5707963267948966, 1.5707963267948966, 0.0],
        'flex_perc_bents': [0.0, 0.0, 0.0, 0.0, 0.0],
        'abd_perc_bents': [0.0, 5000.0, 0.0, 10000.0, 5000.0]
    },
    {
        'name': 'fingers_fully_flexed',
        'exo_angles': [
              [0.5731907587621671, 0.31139137096301767, 1.3585889221596155, -0.9976055680327295, 2.6675858611553624, -1.1721384932321626, 2.1439870855570637, 2.1439870855570637],
              [0.5731907587621671, 0.31139137096301767, 1.3585889221596155, -0.9976055680327295, 2.6675858611553624, -1.1721384932321626, 2.1439870855570637, 2.1439870855570637],
              [0.5731907587621671, 0.31139137096301767, 1.3585889221596155, -0.9976055680327295, 2.6675858611553624, -1.1721384932321626, 2.1439870855570637, 2.1439870855570637],
              [0.5731907587621671, 0.31139137096301767, 1.3585889221596155, -0.9976055680327295, 2.6675858611553624, -1.1721384932321626, 2.1439870855570637, 2.1439870855570637],
              [0.5731907587621671, 0.31139137096301767, 1.3585889221596155, -0.9976055680327295, 2.6675858611553624, -1.1721384932321626, 2.1439870855570637, 2.1439870855570637],
        ],
        'exo_poss': [
              [[-20.6385, 81.9688, -43.5289], [-13.937345628732905, 90.93290992300746, -50.71425060944747], [11.032546825430307, 106.52154753022128, -69.64831642686983], [35.86460207479656, 81.88384725260688, -70.81139730233009], [66.29686532560699, 86.37998703957778, -87.50457196892333], [43.744437487010416, 67.6695445432622, -68.36541472057608], [55.9196000096089, 35.872785997322445, -60.2579142722554], [24.447869489019467, 47.31161843883632, -50.07541504984596], [30.722171867582432, 52.85157386334411, -55.54734556446562]],
              [[62.2365, 72.0, 1.4391], [73.41082559447483, 79.21279748146755, 1.4391], [101.40275229401803, 97.28101078820342, -9.284318650304261], [98.49091634246483, 95.40148053465556, -44.112304199532346], [121.49664099409999, 110.2512029115207, -65.91190003484951], [92.66718930850061, 91.64238444172435, -59.01446640589323], [76.13550273063379, 80.97152056675306, -87.95986332929041], [64.668518324196, 73.56981783780468, -55.7306364484794], [72.94541422063409, 78.91238400624677, -57.44818733719986]],
              [[71.2365, 49.65, 1.4391], [82.41082559447484, 56.862797481467545, 1.4391], [110.40275229401806, 74.93101078820342, -9.284318650304261], [107.49091634246486, 73.05148053465557, -44.112304199532346], [130.4966409941, 87.90120291152071, -65.91190003484951], [101.66718930850061, 69.29238444172435, -59.01446640589323], [85.13550273063379, 58.62152056675306, -87.95986332929041], [73.668518324196, 51.219817837804676, -55.7306364484794], [81.94541422063409, 56.56238400624676, -57.44818733719986]],
              [[62.2365, 27.3, 1.4391], [73.41082559447483, 34.51279748146755, 1.4391], [101.40275229401803, 52.58101078820342, -9.284318650304261], [98.49091634246483, 50.70148053465556, -44.112304199532346], [121.49664099409999, 65.5512029115207, -65.91190003484951], [92.66718930850061, 46.942384441724336, -59.01446640589323], [76.13550273063379, 36.27152056675304, -87.95986332929041], [64.668518324196, 28.869817837804653, -55.7306364484794], [72.94541422063409, 34.21238400624674, -57.44818733719986]],
              [[53.2365, 4.95, 0.4391], [64.41082559447483, 12.16279748146755, 0.4391], [92.40275229401803, 30.23101078820342, -10.284318650304261], [89.49091634246483, 28.35148053465556, -45.112304199532346], [112.49664099409999, 43.20120291152071, -66.91190003484951], [83.66718930850061, 24.59238444172434, -60.01446640589323], [67.13550273063379, 13.921520566753049, -88.95986332929041], [55.668518324196, 6.5198178378046645, -56.7306364484794], [63.94541422063409, 11.86238400624675, -58.44818733719986]],
        ],
        'exo_rots': [
              [[0.6682001915566583, -0.6122926660077799, -0.2855167591915686, 0.31158686650350687], [0.5528636564813678, -0.6680305936154636, -0.10078320604119645, 0.4877700777168288], [0.5618043482636318, -0.7355872644474377, -0.013832987745463418, 0.3782801859797115], [0.4457833586138599, -0.8099511365523631, 0.3421880688464123, -0.16782037754589035], [0.5551613502068743, -0.7915443721644421, 0.08724306570937593, 0.24008754573469457], [0.04554253898348497, -0.41922349241372225, 0.5601261950853825, -0.7130471135419816], [0.34774293654439925, -0.7436435592832471, 0.4414638460410638, -0.36218611163137326], [-0.22132271779754922, -0.03768427115616757, 0.5165575784601331, -0.8262955999093413], [-0.5594932429141, 0.7075891675694395, 0.05275214129638761, -0.42837144239607955]],
              [[1.0, 0.0, 0.0, 0.0], [0.9592118787649138, 0.0, 0.0, 0.28268811725342186], [0.9476091479978174, -0.0438357133759931, 0.14874249895227115, 0.2792686911723227], [0.6438086123282211, -0.20955384568470786, 0.7110540760418479, 0.18973602028880554], [0.9055145031278199, -0.09325606647425773, 0.3164346899265205, 0.26686303172607706], [-0.09498252864116746, -0.28129879036116207, 0.9544976414934956, -0.027992180651592452], [0.4487916320482974, -0.2498381874154602, 0.8477461290782409, 0.132262813160925], [-0.5297627820945614, -0.2356635987129092, 0.7996491875010855, -0.1561257181823843], [-0.9556416857983177, 0.02436725644084825, -0.0826825055756375, -0.2816359502084745]],
              [[1.0, 0.0, 0.0, 0.0], [0.9592118787649138, 0.0, 0.0, 0.28268811725342186], [0.9476091479978174, -0.0438357133759931, 0.14874249895227115, 0.2792686911723227], [0.6438086123282211, -0.20955384568470786, 0.7110540760418479, 0.18973602028880554], [0.9055145031278199, -0.09325606647425773, 0.3164346899265205, 0.26686303172607706], [-0.09498252864116746, -0.28129879036116207, 0.9544976414934956, -0.027992180651592452], [0.4487916320482974, -0.2498381874154602, 0.8477461290782409, 0.132262813160925], [-0.5297627820945614, -0.2356635987129092, 0.7996491875010855, -0.1561257181823843], [-0.9556416857983177, 0.02436725644084825, -0.0826825055756375, -0.2816359502084745]],
              [[1.0, 0.0, 0.0, 0.0], [0.9592118787649138, 0.0, 0.0, 0.28268811725342186], [0.9476091479978174, -0.0438357133759931, 0.14874249895227115, 0.2792686911723227], [0.6438086123282211, -0.20955384568470786, 0.7110540760418479, 0.18973602028880554], [0.9055145031278199, -0.09325606647425773, 0.3164346899265205, 0.26686303172607706], [-0.09498252864116746, -0.28129879036116207, 0.9544976414934956, -0.027992180651592452], [0.4487916320482974, -0.2498381874154602, 0.8477461290782409, 0.132262813160925], [-0.5297627820945614, -0.2356635987129092, 0.7996491875010855, -0.1561257181823843], [-0.9556416857983177, 0.02436725644084825, -0.0826825055756375, -0.2816359502084745]],
              [[1.0, 0.0, 0.0, 0.0], [0.9592118787649138, 0.0, 0.0, 0.28268811725342186], [0.9476091479978174, -0.0438357133759931, 0.14874249895227115, 0.2792686911723227], [0.6438086123282211, -0.20955384568470786, 0.7110540760418479, 0.18973602028880554], [0.9055145031278199, -0.09325606647425773, 0.3164346899265205, 0.26686303172607706], [-0.09498252864116746, -0.28129879036116207, 0.9544976414934956, -0.027992180651592452], [0.4487916320482974, -0.2498381874154602, 0.8477461290782409, 0.132262813160925], [-0.5297627820945614, -0.2356635987129092, 0.7996491875010855, -0.1561257181823843], [-0.9556416857983177, 0.02436725644084825, -0.0826825055756375, -0.2816359502084745]],
        ],
        'fingertips_poss': [
              [21.408659017258493, 63.30380158375968, -55.64437168170868],
              [74.965674521228, 80.21642050355786, -43.656231814812],
              [83.965674521228, 57.86642050355784, -43.656231814812],
              [74.965674521228, 35.51642050355782, -43.656231814812],
              [65.965674521228, 13.16642050355783, -44.656231814812],
        ],
        'fingertips_rots': [
              [-0.3583200692598258, 0.19743674689756457, 0.432922862925399, -0.8032454504674253],
              [-0.7342060767905623, -0.1819164379500938, 0.6172753560345066, -0.21637694248656456],
              [-0.7342060767905623, -0.1819164379500938, 0.6172753560345066, -0.21637694248656456],
              [-0.7342060767905623, -0.1819164379500938, 0.6172753560345066, -0.21637694248656456],
              [-0.7342060767905623, -0.1819164379500938, 0.6172753560345066, -0.21637694248656456],
        ],
        'flex_perc_bent_angles': [4.884999937332334, 4.884999937332334, 4.884999937332334, 4.884999937332334, 4.884999937332334],
        'abd_perc_bent_angles': [0.5731907587621671, 0.5731907587621671, 0.5731907587621671, 0.5731907587621671, 0.5731907587621671],
        'flex_perc_bents': [10000.0, 10000.0, 10000.0, 10000.0, 10000.0],
        'abd_perc_bents': [10000.0, 10000.0, 10000.0, 10000.0, 10000.0]
    },
]




# Using a fixture was needed because otherwise the SG_Sim keeps existing even between complete runs of this file once every x times. 
# That will cause issues if a simulator already exist, causing values to be reset to 0 in weird ways.
# Using a fixture instead makes pytest clean them up after running the file.
#@pytest.fixture(scope="function")
def init():
    """Set up test environment for kinematics tests."""
    global device_info, simulator

    # Initialize API
    SG_main.init(0, SG_T.Com_type.SIMULATED_GLOVE, SG_main.SG_sim.Simulation_Mode.STEADY_MODE)

    # Create device info
    device_info = SG_T.Device_Info(
        hand_id,
        hand=SG_T.Hand.RIGHT,
        nr_fingers_tracking=5,
        nr_fingers_force=4,
        firmware_version="0.0.0-sim",
        device_type=SG_T.DeviceType.REMBRANDT,
        communication_type=SG_T.Com_type.SIMULATED_GLOVE,
        exo_linkage_type=SG_T.Exo_linkage_type.REMBRANDT_PROTO_04,
        encoding_type=SG_T.Encoding_type.REMBRANDT_v01,
        data_origin=SG_T.Data_Origin.LIVE_TEST_SIM,
        )

    # Create simulator
    simulator = SG_sim.create_glove_sim_device(device_info, SG_sim.Simulation_Mode.STEADY_MODE)
    SG_timer.stop_timer(SG_cb._high_freq_timer_id)

## this is executed for each test. The "yield" means the test is executed in the middle of that.
@pytest.fixture(autouse=True, scope="function")
def clean_state_before_test():
    init()
    yield
    SG_main.exit()





def set_and_update_exo_angles(exo_angles_rad):
    print("SIMS: ", SG_sim._dict_device_id_Live_Test)
    simulator.set_exo_rad_hand(exo_angles_rad)

    # Trigger simulator update and device update to ensure data is synchronized
    SG_sim.update_all_glove_sims()
    device = SG_devices.get_rembrandt_device(hand_id)
    device.update_data()





@pytest.mark.parametrize("test_case", test_cases, ids=lambda x: x['name'])
def test_get_exo_joints_poss_rots(test_case):
    set_and_update_exo_angles(test_case['exo_angles'])

    exo_poss, exo_quats = SG_main.get_exo_joints_poss_rots(hand_id)

    latest_exo_angles_rad = SG_main.get_exo_angles_rad(hand_id)
    latest_exo_angles_deg = SG_main.get_exo_angles_deg(hand_id)


    error = "None"

    error_tolerance = 1e-16
    if not np.allclose(exo_poss, test_case['exo_poss'], atol=error_tolerance):
        print("exo_poss_output:", sg_logger.nested_array_to_str(exo_poss))
        print("exo_poss_expected:", sg_logger.nested_array_to_str(test_case['exo_poss']))
        diff = np.array(exo_poss) - np.array(test_case['exo_poss'])
        print("Max absolute difference:", np.max(np.abs(diff)))
        print("Where differences occur:", np.argwhere(np.abs(diff) > error_tolerance))
        print("Differences at positions:", diff[np.abs(diff) > error_tolerance])
        error = "exo_poss mismatch"


    if not np.allclose(exo_quats, test_case['exo_rots'], atol=error_tolerance):
        print("exo_quats_output:", sg_logger.nested_array_to_str(exo_quats))
        print("exo_quats_expected:", sg_logger.nested_array_to_str(test_case['exo_rots']))
        print("Max absolute difference:", np.max(np.abs(diff)))
        print("Where differences occur:", np.argwhere(np.abs(diff) > error_tolerance))
        print("Differences at positions:", diff[np.abs(diff) > error_tolerance])
        error += ", exo_rots mismatch"
        

    if error != "None":
        print("latest_angles_rad:", sg_logger.nested_array_to_str(latest_exo_angles_rad))
        print("latest_angles_deg:", sg_logger.nested_array_to_str(latest_exo_angles_deg))
        print("exo_angles_rad_input:", sg_logger.nested_array_to_str(test_case['exo_angles']))
        assert False, error


# Single test case dictionary containing all data for easy copy-paste from terminal output


@pytest.mark.parametrize("test_case", test_cases, ids=lambda x: x['name'])
def test_perc_angles(test_case):

    set_and_update_exo_angles(test_case['exo_angles'])

    perc_bent_angles_flex, perc_bent_angles_abd = SG_main.get_raw_percentage_bent_angles(hand_id)

    assert np.allclose(perc_bent_angles_abd, test_case['abd_perc_bent_angles'])
    assert np.allclose(perc_bent_angles_flex, test_case['flex_perc_bent_angles'])



@pytest.mark.parametrize("test_case", test_cases, ids=lambda x: x['name'])
def test_perc_bents(test_case):
    set_and_update_exo_angles(test_case['exo_angles'])

    perc_bents_flex, perc_bents_abd = SG_main.get_percentage_bents(hand_id)

    assert np.allclose(perc_bents_flex, test_case['flex_perc_bents'])
    assert np.allclose(perc_bents_abd, test_case['abd_perc_bents'])


@pytest.mark.parametrize("test_case", test_cases, ids=lambda x: x['name'])
def test_fingertips_poss_rots(test_case):
    set_and_update_exo_angles(test_case['exo_angles'])

    fingertips_poss, fingertips_rots = SG_main.get_fingertips_pos_rot(hand_id)

    assert np.allclose(fingertips_poss, test_case['fingertips_poss'])
    assert np.allclose(fingertips_rots, test_case['fingertips_rots'])
















# Test configuration - will be set up in the test function
hand_id = 9997
device_info = None
simulator = None




single_finger_base_inputs = [
    (0,1,2)
]

single_finger_link_inputs = [
    [[1, 0, 0], [2, 0, 0], [3, 0, 0], [4, 0, 0], [5, 0, 0], [6, 0, 0], [7, 0, 0], [8, 0, 0]]
]

single_finger_angle_inputs = [
    [(0, 0, np.float64(0)), (0, np.float64(0), 0), (0, np.float64(0), 0), (0, np.float64(0), 0), (0, np.float64(0), 0), (0, np.float64(0), 0), (0, np.float64(0), 0), (0, np.float64(0), 0)]
]
single_finger_pos_outputs = [
    [array([0, 1, 2]), array([1., 1., 2.]), array([3., 1., 2.]), array([6., 1., 2.]), array([10.,  1.,  2.]), array([15.,  1.,  2.]), array([21.,  1.,  2.]), array([28.,  1.,  2.]), array([36.,  1.,  2.])]
]

single_finger_quat_outputs = [
    [array([1, 0, 0, 0]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.])]
]




def pytest_assertrepr_compare(op, left, right):
    """
    Hook to customize how pytest prints objects when an assert fails.
    Called for expressions like `assert left == right`
    """
    # Only handle equality asserts
    if op == "==":
        # Check if either object is a nested array/list
        if isinstance(left, (list, np.ndarray)) or isinstance(right, (list, np.ndarray)):
            left_str = sg_logger.nested_array_to_str(left)
            right_str = sg_logger.nested_array_to_str(right)
            return [
                "Comparing nested arrays with custom formatting:",
                "Left:",
                left_str,
                "Right:",
                right_str,
            ]



# Test configuration - will be set up in the test function
hand_id = 9997
device_info = None
simulator = None




single_finger_base_inputs = [
    (0,1,2)
]

single_finger_link_inputs = [
    [[1, 0, 0], [2, 0, 0], [3, 0, 0], [4, 0, 0], [5, 0, 0], [6, 0, 0], [7, 0, 0], [8, 0, 0]]
]

single_finger_angle_inputs = [
    [(0, 0, np.float64(0)), (0, np.float64(0), 0), (0, np.float64(0), 0), (0, np.float64(0), 0), (0, np.float64(0), 0), (0, np.float64(0), 0), (0, np.float64(0), 0), (0, np.float64(0), 0)]
]
single_finger_pos_outputs = [
    [array([0, 1, 2]), array([1., 1., 2.]), array([3., 1., 2.]), array([6., 1., 2.]), array([10.,  1.,  2.]), array([15.,  1.,  2.]), array([21.,  1.,  2.]), array([28.,  1.,  2.]), array([36.,  1.,  2.])]
]

single_finger_quat_outputs = [
    [array([1, 0, 0, 0]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.]), array([1., 0., 0., 0.])]
]


@pytest.mark.parametrize("base", single_finger_base_inputs)
@pytest.mark.parametrize("linkages", single_finger_link_inputs)
@pytest.mark.parametrize("angles", single_finger_angle_inputs)
def test_forward_kinematics(base, linkages, angles):
    
    positions, quaternions = SG_math.forward_kinematics_3d(base, linkages, angles, None)


    assert np.allclose(positions,   single_finger_pos_outputs)
    assert np.allclose(quaternions, single_finger_quat_outputs)

